!function(n,$){"use strict";var t,e="incom_wrapper",i="#"+e,o="html",a="comments-and-form",r="#"+a,c="incom-commentform",u="data-incom",s=u+"-comment",l=[],f=u+"-bubble",d=u+"-ref",m="incom-active",v="."+m,h="incom-visible-comment",p="."+h,b="incom-position-",g="incom-bubble",y="."+g,w=g+"-style",k=g+"-static",S="."+k,C=g+"-dynamic",A=g+"-active",x=g+"-link",I="incom-comments-wrapper",T="."+I,O="incom-reply",B="."+O,W="incom-cancel",_="."+W,q="incom-info-icon",D="."+q,E="incom-scrolled-to",F=r+" .comment",N="data_incom",j=0,H=$(window).width(),K,Q,X;n.rebuild=function(){H=$(window).width(),l=[],$("#incom_wrapper .incom-bubble").remove(),G();var n=$(r+":visible");n.length&&(kn(),Sn("out"))};var Y=function(n){t=$.extend({selectors:"p",moveSiteSelector:o,countStatic:!0,alwaysStatic:!1,defaultBubbleText:"+",bubbleStyle:"bubble",bubbleAnimationIn:"default",bubbleAnimationOut:"default",position:"left",background:"white",backgroundOpacity:"1",displayBranding:!1},n)},z=function(){var n,a,r;0===$(i).length&&(n=document.createDocumentFragment(),a=document.createElement("div"),r=document.querySelector(o),a.setAttribute("id",e),a.className=b+t.position,n.appendChild(a),r.appendChild(n)),G()},G=function(){var n,e,i;for(n=$(t.selectors),e=0,i=n.length;i>e;e+=1){var o=$(n[e]);J(o),L.createFromElement(o)}},J=function(n,t){if(t=t||0,!n.attr(u)){var e=M(n);t=P(t,e);var i=e+t;n.attr(u,i)}},L={set:function(n){var t=$.extend({posX:void 0,posY:void 0,id:void 0,visible:!1},n)},createFromElement:function(n){R(n)}},M=function(n){var t=n.prop("tagName").substr(0,5);return t},P=function(n,t){var e=t+n;if(-1!==$.inArray(e,l))for(;-1!==$.inArray(e,l);)n++,e=t+n;return l.push(e),n},R=function(n){var t=U(n),e=Z(n),o=$("<a/>",{href:"","class":x}).text(t).wrap(e).parent().appendTo(i);en(o),mn(n,o),hn(o)?(on(n,o),an(n,o)):o.hide()},U=function(n){var e;return e=tn(n)?V(n):t.defaultBubbleText},V=function(n){var t=n.attr(u),e="["+s+"="+t+"]",i=$(e).length;return i+=$(e+" .children li").length},Z=function(n){var t=n.attr(u),e='<div class="'+nn(n)+'" '+f+'="'+t+'" />';return e},nn=function(n){var e=g,i=" ";return(t.alwaysStatic||tn(n)&&t.countStatic)&&(e+=i+k),e+=tn(n)||!tn(n)&&"bubble"===t.bubbleStyle?i+w:i+C},tn=function(n){var t=V(n);return $.isNumeric(t)&&t>0?!0:!1},en=function(n){n.hasClass(k)&&n.css("display","block")},on=function(n,e){e.hasClass(k)||n.add(e).hover(function(){$(y+":not("+S+")").hide(),"fadein"===t.bubbleAnimationIn?e.stop(!0,!0).fadeIn():e.stop(!0,!0).show(),hn(e)||e.hide()},function(){"fadeout"===t.bubbleAnimationOut?e.stop(!0,!0).fadeOut():e.stop(!0,!0).delay(700).hide(0)})},an=function(n,t){t.on("click",function(e){e.preventDefault();var i=$(this);i.hasClass(A)?(kn(!0),i.removeClass(A)):(_n(m),n.addClass(m),kn(),t.addClass(A),cn(t))})},rn=function(){var n;return n=0===$(T).length?$("<div/>",{"class":I}).appendTo(i).css("background-color","rgba("+En(t.background)+","+t.backgroundOpacity+")"):$(T)},cn=function(n){var t=rn();fn(),sn(),mn(n,t),pn(t),yn(),un()},un=function(){$(document).ready(wn()).ajaxStop(function(){wn()})},sn=function(){$(r).appendTo(T).show(),ln()},ln=function(){var n=$("<input>").attr("type","hidden").attr("name",N).val(dn);$(r+" .form-submit").append($(n))},fn=function(){var n="["+s+"="+dn()+"]";$(F).hide(),$(F+n).addClass(h).show(),$(p+" .children li").show()},dn=function(){var n=$(v).attr(u);return n},mn=function(n,t){var e=n.offset();t.css({top:e.top,left:In()?e.left+n.outerWidth():e.left-t.outerWidth()})},vn=function(n){K=n.outerWidth(),Q=n.offset().left,X=Q+K},hn=function(n){return vn(n),X>H||0>Q?!1:!0},pn=function(n){vn(n),In()&&X>H?(bn(X-H),Sn("in")):!In()&&0>Q&&(bn(-Q),Sn("in"))},bn=function(n){j=n},gn=function(){return j},yn=function(){$("html").click(function(n){0===$(n.target).parents(i).length&&kn(!0)})},wn=function(){$(_).click(function(n){n.preventDefault(),kn(!0)})},kn=function(n){var t=$(y),e=$(T);$(r).appendTo(i).hide(),$(p).removeClass(h),t.hasClass(A)&&(t.removeClass(A),n?e.fadeOut("fast",function(){$(this).remove(),_n(m)}):e.remove(),Sn("out"))},Sn=function(n){var e=$(t.moveSiteSelector);e.css({position:"relative"}),Cn(e,n),t.moveSiteSelector!==o&&(xn(n,y),xn(n,T))},Cn=function(n,t){var e;"in"===t?e=gn():"out"===t&&(e="initial"),An(n,e)},An=function(n,t){var e=In()?"right":"left",i={};i[e]=t,n.css(i)},xn=function(n,t){var e=$(t);"in"===n?e.css({left:In()?"-="+gn():"+="+gn()}):"out"===n&&e.css({left:In()?"+="+gn():"-="+gn()})},In=function(){return"right"===t.position?!0:!1},Tn=function(){var n=d,t=u;On(n,t),Wn(n,t)},On=function(n,t){$("["+n+"]").each(function(){var e=$(this),i=e.attr(n),o=$("["+t+'="'+i+'"]');o.length||e.parent().remove()})},Bn={init:function(){this.permalinksHandler()},permalinksHandler:function(){$(r).on("click","a.incom-permalink",function(){var n=$(this.hash);if(n.length){jn(n);var t=$(this).attr("href");return Nn(t),!1}})}},Wn=function(n,t){$("["+n+"]").click(function(){var e=$(this).attr(n),i=$("["+t+'="'+e+'"]');i.length&&(jn(i),_n(E),i.addClass(E))})},_n=function(n){var t=$("."+n);0!==t.length&&(t.removeClass(n),0===t.prop("class").length&&t.removeAttr("class"))},qn=function(){var n=$(".incom-cancel-x"),e=$(Dn());t.displayBranding!==!0&&1!==t.displayBranding||$(D).length||n.after(e)},Dn=function(){return'<a class="'+q+'" href="http://kevinw.de/inline-comments/" title="Inline Comments by Kevin Weber" target="_blank">i</a>'},En=function(n){var t=parseInt(Fn(n).substring(0,2),16),e=parseInt(Fn(n).substring(2,4),16),i=parseInt(Fn(n).substring(4,6),16);return t+","+e+","+i},Fn=function(n){return"#"===n.charAt(0)?n.substring(1,7):n};$.easing.quart=function(n,t,e,i,o){return-i*((t=t/o-1)*t*t*t-1)+e};var Nn=function(n){history.pushState(null,null,n),history.pushState?history.pushState(null,null,n):location.hash=n},jn=function(n){var t=$("html, body"),e=n.offset().top-115;t.animate({scrollTop:e},1200,"quart")};n.init=function(n){Y(n),z(),qn(),Tn(),$(B+" .comment-reply-link").on("click",function(){$(r+" #commentform").attr("id",c)}),Bn.init()}}(window.incom=window.incom||{},jQuery);